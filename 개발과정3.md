# Simtime 개발일지 3

## Kakao Map api 이용하기

### MAP Atomic 구성하기

```js
/*global kakao*/
import React, { useState, useEffect } from "react";
import styled from "styled-components";
import PropTypes from "prop-types";

const MapWrap = styled.div`
  width: ${(props) => (props.width ? props.width : "100%")};
  height: ${(props) => (props.height ? props.height : "150px")};
`;

function Map(props) {
  const { lat, lng, hight, width, mapId } = props;

  const [loadMap, setLoadMap] = useState(false);
  // const [mapLat, setLat] = useState(lat);
  // const [mapLng, setLng] = useState(lng);

  useEffect(() => {
    var eventLocation = new kakao.maps.LatLng(lat, lng);

    kakao.maps.load(() => {
      let container = document.getElementById(mapId);
      let options = {
        center: eventLocation,
        level: 7,
      };

      const map = new window.kakao.maps.Map(container, options);
      const marker = new kakao.maps.Marker({
        position: eventLocation,
      });

      marker.setMap(map);
    });
  }, []);

  return <MapWrap {...props} id={mapId}></MapWrap>;
}

export default Map;

Map.propTypes = {
  height: PropTypes.string,
  width: PropTypes.string,
  lat: PropTypes.number,
  lng: PropTypes.number,
  mapId: PropTypes.string,
};

Map.defaultProps = {
  height: "50%",
  width: "100%",
  lat: 37.506502,
  lng: 127.053617,
  mapId: "myMap",
};

```

![map01](https://github.com/arara90/images/blob/master/Simtime/simtime_017.png?raw=true)

여기서 주의할 점은 반드시 mapId를 전달하는 것이 좋다. 그림과 같이 두 개의 지도가 쓰이는 상황에서 원하는 지도에 해당하는 곳에서만 작업을 해야한다. 만약 mapId가 동일하면 덮어씌워지므로 어차피 한쪽만 나올 것이다...





### 주소 검색 자동완성?

 포털 검색이나 카카오 지도에 직접 들어가서 주소 검색 시 볼 수 있는 키워드 입력시 실시간으로 자동완성된 목록을 보여주는 기능을 구현하고자 했다. 하지만 찾아본 결과 카카오에서는 해당 api를 지원하지 않는다. 

아쉽지만 엔터 키 이벤트 발생 후 데이터를 받아와서 목록을 받아오는 방식으로 우선 구현하자.

참고로 구글은 가능하다. (https://developers.google.com/places/web-service/autocomplete?hl=ko) 



(추가) 해당 API없어도 충분히 가능하다. handleChange에서 들어올때마다 새로운 목록을 받아오면 된다.

생각보다 버벅이지 않고 빠른 속도로 데이터를 받아온다.

```js
import React, { useState, useCallback, useRef } from "react";
import axios from "axios";
import styled from "styled-components";
import PropTypes from "prop-types";
import Paragraph from "..//Font/Paragraph";

.
.
.

function SearchBox(props) {
//...생략
  const startSearch = (keyword) => {
    return new Promise(function (resolve, reject) {
      resolve(search(keyword));
    });
  };

  const handleChange = (e) => {
    var val = e.target.value;
    setCurrOption(val);

    if (val.length > 0) {
      startSearch(val)
        .then((resolvedData) => {
          setOptionDatas(resolvedData.items);
        })
        .then(() => {
          console.log("then", optionDatas);
          setShowOptions(true);
        });
    }
  };

  const changeShowOptions = () => {
    setShowOptions(!showOptions);
  };

  const changeSelectedOptions = (option) => {
    setShowOptions(!showOptions);
    setSelectedOption(option);
  };

  const renderOptions = (options) => {
    return (
      <OptionWrap
        width={width}
        top={height}
        contentHeight={
          parseInt(height.replace(/[^0-9]/g, "")).toFixed(0) * options.length +
          2 +
          "px"
        }
        showOptions={showOptions}
        onBlur={changeShowOptions}
      >
        {optionDatas.map((option) => {
          return (
            <Option
              height={height}
              key={option.id + option.name}
              isSelected={option.id === selectedOption}
              onClick={() => changeSelectedOptions(option)}
            >
              {option.name}
            </Option>
          );
        })}
      </OptionWrap>
    );
  };

  return (
    <Wrap {...props}>
      <Select
        ref={refName}
        type="text"
        autoComplete="off"
        onChange={handleChange}
        width={width}
        height={height}
        name={name}
        arrow={arrow}
        cursor={cursor}
        value={currOption.name}
      />
      {renderOptions(optionDatas)}
    </Wrap>
  );
}

export default SearchBox;

SearchBox.propTypes = {
  width: PropTypes.string,
  height: PropTypes.string,
  options: PropTypes.array,
  defaultOption: PropTypes.object,
  arrow: PropTypes.bool,
  cursor: PropTypes.string,
};

SearchBox.defaultProps = {
  width: "100%",
  height: "100%",
  options: [{ id: 0, name: "" }],
  defaultOption: null,
  arrow: false,
  cursor: "pointer",
};

```



[Kakao-map-API-키워드로 장소검색하기](http://apis.map.kakao.com/web/sample/keywordBasic/) = 검색어 투썸

![data](https://github.com/arara90/images/blob/master/Simtime/simtime_018.png?raw=true)

```js

const getLocations = () => {
  var placeList = [];
  var ps = new kakao.maps.services.Places(); // 장소 검색 객체를 생성합니다
  //var infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });   
  // 키워드로 장소를 검색합니다
  searchPlaces();

  // 키워드 검색을 요청하는 함수입니다
  function searchPlaces() {
      var keyword = "투썸"

      if (!keyword.replace(/^\s+|\s+$/g, '')) {
          alert('키워드를 입력해주세요!');
          return false;
      }

      // 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
      ps.keywordSearch( keyword, placesSearchCB);
  }

  // 장소검색이 완료됐을 때 호출되는 콜백함수 입니다
  function placesSearchCB(data, status, pagination) {
      if (status === kakao.maps.services.Status.OK) {

          // 정상적으로 검색이 완료됐으면
          // 검색 목록과 마커를 표출합니다
          //displayPlaces(data);
          console.log(data, status, pagination)

          // 페이지 번호를 표출합니다
          //displayPagination(pagination);

      } else if (status === kakao.maps.services.Status.ZERO_RESULT) {

          alert('검색 결과가 존재하지 않습니다.');
          return;

      } else if (status === kakao.maps.services.Status.ERROR) {

          alert('검색 결과 중 오류가 발생했습니다.');
          return;

      }
  }

}

  console.log("hi i am search func")
  return 0;
};
```

await / axios 를 써서 완성해보기

https://anpigon.github.io/blog/kr/@anpigon/react-native-api/

[API TEST PAGE](https://developers.kakao.com/tool/rest-api/open/v2/local/search/keyword.json/get)







# Django-JavaScript 연동

### 문제: django settings.py 에 환경변수들을 javasript에서도 동일하게 불러와 쓰고 싶다.

 즉, App_key와 같은 정보를 담고있는 secret.json 파일로부터 값을 어떻게 받아와 사용하는것이 효율적일까?



참고 1 : https://hyunalee.tistory.com/62

